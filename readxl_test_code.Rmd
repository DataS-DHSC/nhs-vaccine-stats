---
title: "readxl_test_code.Rmd"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(reshape2)

# install using console: 
# ```devtools::install_github("https://github.com/DataS-DHSC/DHSC_colours")```
library(DHSCcolours)
```

## test 2
```{r}
path <- "COVID-19-weekly-announced-vaccinations-1-April-2021.xlsx"
sheets <- (excel_sheets(path))
print(sheets)
```

```{r}
first_dose_tbl <- readxl::read_excel(path, sheet = "NHS Region") %>% 
  dplyr::slice(11:12) %>% 
  dplyr::select(3:10)
first_dose_tbl
```

```{r}
second_dose_tbl <- readxl::read_excel(path, sheet = "NHS Region") %>% 
  dplyr::slice(11:12) %>% 
  dplyr::select(12:19)
second_dose_tbl
```

```{r}
names(first_dose_tbl) <- lapply(first_dose_tbl[1, ], as.character)
first_dose_tbl <- dplyr::slice(first_dose_tbl, 2) %>% 
  tidyr::pivot_longer(cols = everything(), names_to = "age", values_to = "first_dose")
first_dose_tbl$age <- factor(first_dose_tbl$age, levels = first_dose_tbl$age) # lock in factor level order
first_dose_tbl
```

```{r}
names(second_dose_tbl) <- lapply(second_dose_tbl[1, ], as.character)
second_dose_tbl <- dplyr::slice(second_dose_tbl, 2) %>% 
  tidyr::pivot_longer(cols = everything(), names_to = "age", values_to = "second_dose")
second_dose_tbl$age <- factor(second_dose_tbl$age, levels = second_dose_tbl$age) # lock in factor level order
second_dose_tbl
```

```{r}
both_doses_tbl <- first_dose_tbl %>% left_join(second_dose_tbl, by = "age")
both_doses_tbl <- reshape2::melt(both_doses_tbl, id.vars = c("age"), variable.name = "dose", value.name = "total")
both_doses_tbl$total <- as.numeric(both_doses_tbl$total)
both_doses_tbl
```


```{r}
dhsc_primary_0 <- "#00ad93"
dhsc_primary_5 <- "#99ded4"
ggplot2::ggplot(data = both_doses_tbl, aes(age, total, fill = dose)) + geom_col(position = "dodge2") + scale_fill_manual(values = c(dhsc_primary_5, dhsc_primary_0))

# DHSC colours?
# g + scale_colour_dhsc_d(aesthetics = c("colour", "fill"))
```

